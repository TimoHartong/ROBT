#include <stdint.h>
#include "pi_mbox.h"
//#include "ros_utils.h"
#include "swis.h"

// Function to allocate the mapping from IO to user space
// On entry : address
// size : the size of the block in bytes
// On exit address to use
int32_t IOToUser(uint32_t nIOAddr,uint32_t size)
{
  int value;
  _swix(OS_Memory, _IN(0)|_IN(1)|_IN(2)|_OUT(3), 13 | (1<<17) , nIOAddr , size ,&value);
  return value;
}

// Returns clock frequency for UART0
uint32_t UARTClkFreq(void)
{
    uint32_t mbox[36];

    mbox[0] = 8 * 4;
    mbox[1] = MBOX_REQUEST ;
    mbox[2] = MBOX_TAG_GET_CLK_RATE_MEAS ;
    mbox[3] = 8;                                 // Response length
    mbox[4] = 4;                                 // Value lenght
    mbox[5] = CLK_UART;
    mbox[6] = 0;

    mbox[7] = MBOX_TAG_LAST;

    // BCMSupport_SendTempPropertyBuffer
    _swix(0x591C5, _IN(0)| _IN(1) | _IN(2), mbox, mbox, 0);

    return mbox[6];
}

